<!DOCTYPE HTML>
<!--
        Dimension by HTML5 UP
        html5up.net | @ajlkn
        Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
        <title>Client REST TCE</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/main.css" />
        <script src="assets/js/jquery.min.js"></script>
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    </head>
    <body class="is-preload">

        <!-- Wrapper -->
        <div id="wrapper">

            <!-- Header -->
            <header id="header">
                <div class="logo">
                    <span class="icon fa-gem"></span>
                </div>
                <div class="content">
                    <div class="inner">
                        <h1>REST - Biblioteca</h1>
                    </div>
                </div>
                <nav>
                    <ul>
                        <li><a href="#intro">Pesquisa</a></li>
                        <!--<li><a href="#work">Work</a></li>-->
                        <li><a href="#about">Inserir</a></li>
                        <!--<li><a href="#contact">Contact</a></li>-->
                        <!--<li><a href="#elements">Elements</a></li>-->
                    </ul>
                </nav>
            </header>

            <!-- Main -->
            <div id="main">

                <!-- Intro -->
                <article id="intro">
                    <section>
                        <h2 class="major">Pesquisa de Acervo</h2>
                        <input type="text" name="demo-name" id="demo-name" value="" placeholder="Digite aqui . . ." />
                        <div class="table-wrapper">
                            <table class="alt" id = "tabela">
                                <thead>
                                    <tr>
                                        <th>Descrição</th>
                                        <th>Ano de Publicação</th>
                                        <th>Autor/Escritor</th>
                                        <th>Data Inclusão</th>
                                        <th>Data Alteração</th>
                                        <th>Data Exclusão</th>
                                        <th>Tipo</th>
                                        <th>EDIT</th>
                                        <!--<th>DEL</th>-->
                                    </tr>
                                </thead>
                                <tbody id = "tabela_body">
                                <script>
                                    var rootURL = "http://localhost:8080/REST_TCE_JAVA/webresources/rest";
                                    var txt = document.getElementById('demo-name');
                                    txt.addEventListener('input',
                                            function (e) {
                                                $.ajax({
                                                    url: rootURL + '/' + txt.value,
                                                    headers: {
                                                        'Content-Type': 'application/x-www-form-urlencoded'
                                                    },
                                                    type: "GET", /* or type:"GET" or type:"PUT" */
                                                    dataType: "json",
                                                    data: {
                                                    },
                                                    success: function (result) {
                                                        console.log(result);
                                                        var conteudo = document.createElement('tbody');
                                                        result.forEach(function (element, index, array) {
                                                            var tr = document.createElement('tr');

                                                            tr.appendChild(document.createElement('td'));
                                                            tr.appendChild(document.createElement('td'));
                                                            tr.appendChild(document.createElement('td'));
                                                            tr.appendChild(document.createElement('td'));
                                                            tr.appendChild(document.createElement('td'));
                                                            tr.appendChild(document.createElement('td'));
                                                            tr.appendChild(document.createElement('td'));
                                                            tr.appendChild(document.createElement('td'));

                                                            tr.cells[0].appendChild(document.createTextNode('' + element["descricao"]));
                                                            tr.cells[1].appendChild(document.createTextNode('' + element["ano_pub"]));
                                                            tr.cells[2].appendChild(document.createTextNode('' + element["autor"]));
                                                            tr.cells[3].appendChild(document.createTextNode('' + element["data_incluso"]));
                                                            tr.cells[4].appendChild(document.createTextNode('' + element["data_alterado"]));
                                                            tr.cells[5].appendChild(document.createTextNode('' + element["data_excluido"]));
                                                            tr.cells[6].appendChild(document.createTextNode('' + element["tipo"]));
                                                            tr.cells[7].innerHTML = "<a class='fas fa-edit' onclick='preenche(" + element["id"] + ")'/>";
                                                            conteudo.appendChild(tr);
                                                            conteudo.id = "tabela_body";
                                                        });
                                                        document.getElementById("tabela_body").replaceWith(conteudo);
                                                    },
                                                    error: function () {
                                                        console.log("error");
                                                        var conteudo = document.createElement('tbody');
                                                        conteudo.id = "tabela_body";
                                                        document.getElementById("tabela_body").replaceWith(conteudo);
                                                    }
                                                });
                                            }
                                    );
                                </script>

                                </tbody>

                            </table>
                        </div>
                    </section>
                </article>

                <!-- Contact -->

                <article id="contact">
                    <h2 class="major">Edição de Item</h2>
                    <!--<form method="POST" action="webresources/rest">-->
                    <div class="fields">
                        <div style="width: 100%">
                            <label for="descricao_Ed" style="float:left; width:20%">Descrição:</label>
                            <textarea id="descricao_Ed" name="descricao_Ed"  rows="3" cols="150" style="float:left; width:70%; "></textarea>
                        </div>
                        </br>
                        </br>
                        </br>
                        </br>
                        </br>
                        <div class="field third" style="width: 100%">
                            <input type="text" name="id_Ed" id="id_Ed" style="display: none"/>
                            <label for="autor_Ed" style="float:left; width:7%">Autor:</label>
                            <input type="text" name="autor_Ed" id="autor_Ed" style="display: table-cell;float:left; width:40%"/>
                            <label for="ano_pub_Ed" style="float:left; width:15%; padding-left:15px;">Ano de Publicação:</label>
                            <input type="text" name="ano_pub_Ed" id="ano_pub_Ed" style="display: table-cell;float:left; width:20%; "/>
                        </div>
                        </br>
                        </br>
                        </br>
                        </br>
                        <div style="width: 100%">

                            <div style="float:left;width:30%;padding-left:15px;">
                                <label for="dC_ed">Data de Inclusão</label>
                                <input type="text" name="dC_ed" id="dC_ed" disabled="true"/>


                            </div>
                            <div style="float:left;width:30%;padding-left:15px;">
                                <label for="dE_ed">Data de Alteração</label>
                                <input type="text" name="dE_ed" id="dE_ed" disabled="true"/>
                            </div>
                            <div style="float:left;width:30%;padding-left:15px;">
                                <label for="dX_ed">Data de Exclusão</label>
                                <input type="text" name="dX_ed" id="dX_ed" disabled="true"/>
                            </div>
                        </div>

                    </div>

                    <div class="field">
                        <div class="field half">
                            <input type="radio" id="Rad_livro" name="tipo_ed" value="Livro" checked>
                            <label for="Rad_livro">Livro</label>
                        </div>
                        <div class="field half">
                            <input type="radio" id="Rad_doc" name="tipo_ed" value="Documentos Raros">
                            <label for="Rad_doc">Documentos Raros</label>
                        </div>
                        <div class="field half">
                            <input type="radio" id="Rad_manuscritos" name="tipo_ed" value="Manuscrito">
                            <label for="Rad_manuscritos">Manuscritos</label>
                        </div>
                    </div><br><br>

                    <input type="submit" value="Salvar!" class="primary" onclick="edita()" />
                    <!--</form>-->
                    <script>
                        function preenche(id) {
                            //alert("LOL - " + id);
                            //var idid = new URLSearchParams(window.location.search).get('id');
                            var xhr = new XMLHttpRequest();
                            xhr.onreadystatechange = function () {
                                if (xhr.readyState == XMLHttpRequest.DONE) {
                                    window.location.replace("#contact");
                                    console.log(xhr.responseText);
                                    var json_array = JSON.parse(xhr.responseText);
//                                    alert(json_array.autor);
                                    console.log(json_array.descricao);
                                    document.getElementById("id_Ed").value = json_array.id;
                                    document.getElementById("descricao_Ed").innerHTML = json_array.descricao;
                                    document.getElementById("autor_Ed").value = json_array.autor;
                                    document.getElementById("ano_pub_Ed").value = json_array.ano_pub;
                                    document.getElementById("dC_ed").value = json_array.data_incluso;
                                    document.getElementById("dE_ed").value = json_array.data_alterado;
                                    document.getElementById("dX_ed").value = json_array.data_excluido;
                                    if (json_array.tipo == "Manuscrito") {
                                        document.getElementById("Rad_manuscritos").checked = true;
                                    } else if (json_array.tipo == "Documentos Raros") {
                                        document.getElementById("Rad_doc").checked = true;
                                    } else {
                                        document.getElementById("Rad_livro").checked = true;
                                    }

                                }
                            }
                            xhr.open('GET', 'http://localhost:8080/REST_TCE_JAVA/webresources/rest/ler/' + id, true);
                            xhr.send(null);

                        }
                        function edita() {
                            var json_var = {
                                id: "" + document.getElementById("id_Ed").value,
                                descricao: "" + document.getElementById("descricao_Ed").value,
                                ano_pub: "" + document.getElementById("ano_pub_Ed").value,
                                autor: "" + document.getElementById("autor_Ed").value,
                                data_incluso: "" + document.getElementById("dC_ed").value,
                                data_alterado: "" + document.getElementById("dE_ed").value,
                                data_excluido: "" + document.getElementById("dX_ed").value,
                                tipo: "Livro"
                            };
                            console.log(json_var);
                            var xhr = new XMLHttpRequest();
                            xhr.onreadystatechange = function () {
                                if (xhr.readyState == XMLHttpRequest.DONE) {
                                    document.getElementById('demo-name').dispatchEvent(new Event('input'));
                                    window.location.replace("#intro");

                                }
                            }
                            xhr.open('PUT', 'http://localhost:8080/REST_TCE_JAVA/webresources/rest/', true);
                            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                            xhr.send(JSON.stringify(json_var));
                        }

                    </script>
                </article>

                <article id="about">
                    <h2 class="major">Inclusão de Item</h2>
                    <form method="POST" action="webresources/rest">
                        <div class="fields">
                            <div style="width: 100%">
                                <label for="descricao_Inc" style="float:left; width:20%">Descrição:</label>
                                <textarea id="descricao_Inc" name="descricao_Inc"  rows="3" cols="150" style="float:left; width:70%; "></textarea>
                            </div>
                            </br>
                            </br>
                            </br>
                            </br>
                            </br>
                            <div class="field third" style="width: 100%">
                                <label for="autor_Inc" style="float:left; width:7%">Autor:</label>
                                <input type="text" name="autor_Inc" id="autor_Inc" style="display: table-cell;float:left; width:40%"/>
                                <label for="ano_pub_Inc" style="float:left; width:15%; padding-left:15px;">Ano de Publicação:</label>
                                <input type="text" name="ano_pub_Inc" id="ano_pub_Inc" style="display: table-cell;float:left; width:20%; "/>
                            </div>
                            </br>
                            </br>
                            </br>
                            </br>
                            <div style="width: 100%">

                                <div style="float:left;width:30%;padding-left:15px;">
                                    <label for="dC">Data de Inclusão</label>
                                    <input type="text" name="dC" id="dC" placeholder="AGORA!" disabled="true"/>


                                </div>
                                <div style="float:left;width:30%;padding-left:15px;">
                                    <label for="dE">Data de Alteração</label>
                                    <input type="text" name="dE" id="dE" disabled="true"/>
                                </div>
                                <div style="float:left;width:30%;padding-left:15px;">
                                    <label for="dX">Data de Exclusão</label>
                                    <input type="text" name="dX" id="dX" disabled="true"/>
                                </div>
                            </div>

                        </div>

                        <div class="field">
                            <div class="field half">
                                <input type="radio" id="Rad_livro" name="tipo_inc" value="Livro" checked>
                                <label for="Rad_livro">Livro</label>
                            </div>
                            <div class="field half">
                                <input type="radio" id="Rad_doc" name="tipo_inc" value="Documentos Raros">
                                <label for="Rad_doc">Documentos Raros</label>
                            </div>
                            <div class="field half">
                                <input type="radio" id="Rad_manuscritos" name="tipo_inc" value="Manuscrito">
                                <label for="Rad_manuscritos">Manuscritos</label>
                            </div>
                        </div><br><br>

                        <input type="submit" value="Salvar!" class="primary" onclick="" />
                    </form>
                </article>

            </div>

            <!-- Footer -->
            <footer id="footer">
                <p class="copyright">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
            </footer>

        </div>

        <!-- BG -->
        <div id="bg"></div>

        <!-- Scripts -->

        <script src="assets/js/browser.min.js"></script>
        <script src="assets/js/breakpoints.min.js"></script>
        <script src="assets/js/util.js"></script>
        <script src="assets/js/main.js"></script>

    </body>
</html>
